ㅇㅋ 이거 원인 100% 확정이야.

에러 `-1021 Timestamp ... ahead of the server's time` 는
**니 PC 시간이 바이낸스 서버 시간보다 약 1초(1000ms) 빠른 상태**라서, *서명 필요한 엔드포인트(잔고/주문)* 가 전부 튕기는 거임.
(가격/캔들은 서명 없이도 되니까 200 잘 뜨는 거고)

해결은 2개 루트가 있어. **1번이 정석**.

---

## ✅ 1) 코드로 서버시간 동기화 (추천, 무조건 안정)

매 요청마다 `timestamp` 만들기 전에 **서버 시간 오프셋**을 적용해.

### A. 오프셋 구해서 저장

```python
import time
import requests

BINANCE_BASE = "https://api.binance.com"

def get_server_time_offset_ms():
    r = requests.get(f"{BINANCE_BASE}/api/v3/time", timeout=3)
    server_ms = r.json()["serverTime"]
    local_ms = int(time.time() * 1000)
    return server_ms - local_ms  # 서버 - 로컬

TIME_OFFSET_MS = get_server_time_offset_ms()
print("TIME_OFFSET_MS =", TIME_OFFSET_MS)
```

### B. signed 요청 timestamp 만들 때 적용

```python
def now_ms():
    return int(time.time() * 1000)

def signed_timestamp_ms():
    return now_ms() + TIME_OFFSET_MS
```

그리고 잔고조회/주문/서명요청에 들어가는 `timestamp=`를 전부 `signed_timestamp_ms()`로 바꿔.

---

## ✅ 2) recvWindow 늘리기 (보조, 단독으론 불안)

바이낸스는 기본 허용 오차가 작아서, 네트워크/지연 있으면 또 튕길 수 있음.
그래도 같이 넣어두면 안정감 올라감.

* `recvWindow=5000` (5초) 정도로 고정

```python
params["recvWindow"] = 5000
params["timestamp"] = signed_timestamp_ms()
```

---

## ✅ 3) python-binance 쓰는 중이면 더 쉬운 방법

python-binance `Client`는 원래 `timestamp_offset` 개념이 있어.
초기화 시점에 서버시간 맞춰주면 됨.

```python
from binance.client import Client
import time

client = Client(API_KEY, API_SECRET)

server_time = client.get_server_time()["serverTime"]
local_time  = int(time.time() * 1000)
client.timestamp_offset = server_time - local_time
```

그리고 모든 signed 호출은 자동으로 오프셋 적용됨.

*(그래도 `recvWindow=5000` 같이 주면 더 좋음)*

---

## ✅ 4) 윈도우 시간 자체를 맞추는 방법 (부가)

코드로 맞추는 게 정석이지만, PC 시간이 자주 밀리면 이것도 같이 해.

* 설정 → 시간 및 언어 → 날짜 및 시간
* “자동으로 시간 설정” ON
* “지금 동기화” 눌러서 즉시 sync

---

## 결론

* 캔들/티커 OK인데 잔고만 실패 = **서명 요청 타임스탬프 문제**
* 해결은 **서버 시간 오프셋 적용 + recvWindow 5000**

---

너 지금 코드가 **requests로 직접 호출** 중이야? 아니면 **python-binance Client**로 잔고조회 하고 있어?
둘 중 뭐인지에 맞춰서 “딱 너 코드 형태”로 수정 패치 바로 써줄게.
